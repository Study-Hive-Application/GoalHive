<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile</title>

    <!-- TailwindCSS and AOS (for animations) -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

    <script>
      // Initialize AOS for animations
      document.addEventListener("DOMContentLoaded", function () {
        AOS.init();
      });
    </script>
  </head>

  <body class="bg-gray-100">
    <!-- Profile Section -->
    <section
      class="bg-white p-6 rounded-lg shadow-lg mb-8 max-w-2xl mx-auto mt-32"
      data-aos="fade-up"
      data-aos-duration="1000"
    >
      <div class="flex flex-col lg:flex-row lg:items-start pt-2">
        <!-- Profile Picture Section -->
        <form>
          <div class="lg:mr-8 mb-4 lg:mb-0 text-center lg:text-left">
            <!-- Added the correct id -->
            <img
              id="profile-image-preview"
              class="rounded-full w-36 h-36 mx-auto lg:mx-0 mt-4"
              src="https://via.placeholder.com/150"
              alt="Profile Preview"
            />
            <input
              type="file"
              id="profile-picture"
              accept="image/*"
              class="hidden mt-4 bg-gray-100 px-4 py-2 text-sm text-gray-600 rounded-md cursor-pointer border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              onchange="previewImage(event)"
            />
          </div>
        </form>

        <!-- Profile Details Section -->
        <div class="lg:flex-1" id="profileForm">
          <!-- Profile Header -->
          <form id>
            <div class="mb-1">
              <span class="text-blue-600 font-medium">Name:</span>
              <h2
                class="text-3xl font-semibold text-gray-800 mb-2"
                id="name-display"
              >
                Student Name
              </h2>
            </div>
          </form>
          <form id>
            <input
              type="text"
              class="hidden w-full text-3xl font-semibold mb-2 p-3 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              id="name-input"
              placeholder="Enter Name"
            />
          </form>

          <div class="mb-5 mt-4">
            <span class="text-blue-600 font-medium">Email:</span>
            <p class="text-gray-600 mb-2 text-lg" id="email-display">
              xyz@bmail.com
            </p>
          </div>

          <!-- Phone Number -->
          <form id>
            <div class="mb-1">
              <span class="text-blue-600 font-medium">Phone No:</span>
              <p class="text-gray-600 mb-2 text-lg" id="phone-display">
                91-xxxxxxxxxx
              </p>
            </div>
          </form>
          <form id>
            <input
              type="number"
              class="hidden w-full text-lg mb-2 p-3 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              id="phone-input"
              placeholder="Enter Phone"
            />
          </form>

          <!-- Bio Section -->
          <form id>
            <div class="mb-1 mt-4">
              <span class="text-blue-600 font-medium">Bio:</span>
              <p class="text-gray-600 mb-2 text-lg" id="bio-display">
                Bio: Passionate about coding and physics!
              </p>
            </div>
          </form>
          <form id>
            <input
              type="text"
              class="hidden w-full text-lg mb-2 p-3 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              id="bio-input"
              placeholder="Enter Bio"
            />
          </form>

          <!-- Skills Section -->
          <form id>
            <div class="mb-1 mt-4">
              <span class="text-blue-600 font-medium">Skills:</span>
              <span id="skills-display" class="text-gray-700"
                >Web Development</span
              >
            </div>
          </form>
          <form>
            <input
              type="text"
              class="hidden w-full mt-2 p-3 border-2 border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              id="skills-input"
              placeholder="Enter Skills"
            />
          </form>

          <!-- Subjects Section -->
          <form id>
            <div class="mb-1 mt-4">
              <span class="text-blue-600 font-medium">Subjects:</span>
              <span id="subjects-display" class="text-gray-700"
                >Math, Physics, Coding</span
              >
            </div>

            <div
              id="subjects-dropdown"
              class="hidden mt-2 p-3 border-2 border-gray-300 rounded-md"
            >
              <label class="block mb-1 text-blue-600">Select Subjects:</label>
              <form id="subjects-form" onsubmit="return false;">
                <label class="block"
                  ><input type="checkbox" value="Math" class="mr-2" />
                  Math</label
                >
                <label class="block"
                  ><input type="checkbox" value="Physics" class="mr-2" />
                  Physics</label
                >
                <label class="block"
                  ><input type="checkbox" value="Coding" class="mr-2" />
                  Coding</label
                >
                <label class="block"
                  ><input type="checkbox" value="Chemistry" class="mr-2" />
                  Chemistry</label
                >
                <label class="block"
                  ><input type="checkbox" value="Biology" class="mr-2" />
                  Biology</label
                >
                <label class="block"
                  ><input
                    type="checkbox"
                    value="Computer Science"
                    class="mr-2"
                  />
                  Computer Science</label
                >
                <label class="block">
                  <input
                    type="checkbox"
                    value="Other"
                    class="mr-2"
                    onclick="displayInput()"
                  />
                  Other
                </label>
                <!-- Custom Subject Input Section -->
                <div id="custom-subject-section" class="hidden mt-4">
                  <input
                    type="text"
                    id="custom-subject"
                    placeholder="Enter custom subject"
                    class="w-full mb-2 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                  <button
                    type="button"
                    onclick="addCustomSubject()"
                    class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"
                  >
                    Add Subject
                  </button>
                </div>
              </form>
            </div>
          </form>

          <!-- Edit and Save Buttons -->
          <div class="flex mt-6">
            <button
              type="button"
              onclick="editProfile()"
              class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition ease-in-out duration-200 mr-4"
              id="edit-button"
            >
              Edit
            </button>
            <button
              type="button"
              onclick="saveProfile()"
              class="hidden bg-green-500 text-white px-6 py-2 rounded-md hover:bg-green-600 transition ease-in-out duration-200"
              id="save-button"
            >
              Save
            </button>
            <a href="profile.html" class="ml-4">
              <button
                type="button"
                class="bg-red-500 text-white px-6 py-2 rounded-md hover:bg-red-700 transition ease-in-out duration-200"
                id="back-button"
              >
                Back
              </button>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- JavaScript Functions -->
    <script>
      function editProfile() {
        document.getElementById("name-display").classList.add("hidden");
        document.getElementById("email-display").classList.add("hidden");
        document.getElementById("phone-display").classList.add("hidden");
        document.getElementById("bio-display").classList.add("hidden");
        document.getElementById("skills-display").classList.add("hidden");
        document.getElementById("subjects-display").classList.add("hidden");

        document.getElementById("name-input").classList.remove("hidden");
        document.getElementById("phone-input").classList.remove("hidden");
        document.getElementById("bio-input").classList.remove("hidden");
        document.getElementById("skills-input").classList.remove("hidden");
        document.getElementById("subjects-dropdown").classList.remove("hidden");

        document.getElementById("profile-picture").classList.remove("hidden");

        document.getElementById("edit-button").classList.add("hidden");
        document.getElementById("save-button").classList.remove("hidden");
      }

      function addCustomSubject() {
        const customSubjectInput = document.getElementById("custom-subject");
        const customSubjectValue = customSubjectInput.value.trim();

        if (customSubjectValue) {
          // Create a new label element
          const newCheckbox = document.createElement("label");
          newCheckbox.classList.add("block");

          // Add the checkbox HTML
          newCheckbox.innerHTML = `
          <input type="checkbox" value="${customSubjectValue}" class="mr-2"> ${customSubjectValue}
        `;

          // Append the new checkbox to the subjects form
          const subjectsForm = document.getElementById("subjects-form");
          if (subjectsForm) {
            subjectsForm.appendChild(newCheckbox);
          } else {
            console.error("The subjects-form element is missing.");
          }

          // Clear the input field
          customSubjectInput.value = "";

          // Optionally hide the input section
          const customSubjectSection = document.getElementById(
            "custom-subject-section"
          );
          if (customSubjectSection) {
            customSubjectSection.classList.add("hidden");
          }
        } else {
          alert("Please enter a subject name!");
        }
      }

      function saveProfile() {
        document.getElementById("name-display").textContent =
          document.getElementById("name-input").value;

        const emailInput = document.getElementById("email-input");
        if (emailInput) {
          document.getElementById("email-display").textContent =
            emailInput.value;
        }

        document.getElementById("phone-display").textContent =
          document.getElementById("phone-input").value;
        document.getElementById("bio-display").textContent =
          document.getElementById("bio-input").value;
        document.getElementById("skills-display").textContent =
          document.getElementById("skills-input").value;

        // Collect selected subjects excluding "Other"
        const checkboxes = document.querySelectorAll(
          "#subjects-dropdown input[type='checkbox']"
        );
        const selectedSubjects = Array.from(checkboxes)
          .filter((checkbox) => checkbox.checked && checkbox.value !== "Other") // Exclude "Other"
          .map((checkbox) => checkbox.value);

        document.getElementById("subjects-display").textContent =
          selectedSubjects.join(", ");

        // Reset visibility
        [
          "name-display",
          "email-display",
          "phone-display",
          "bio-display",
          "skills-display",
          "subjects-display",
        ].forEach((id) => {
          document.getElementById(id).classList.remove("hidden");
        });

        [
          "name-input",
          "phone-input",
          "bio-input",
          "skills-input",
          "subjects-dropdown",
        ].forEach((id) => {
          document.getElementById(id).classList.add("hidden");
        });

        const profilePicture = document.getElementById("profile-picture");
        if (profilePicture) {
          profilePicture.classList.add("hidden");
        }

        document.getElementById("edit-button").classList.remove("hidden");
        document.getElementById("save-button").classList.add("hidden");
      }

      function displayInput() {
        const customSubjectSection = document.getElementById(
          "custom-subject-section"
        );
        customSubjectSection.classList.remove("hidden");
      }

      function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function () {
          const output = document.getElementById("profile-image-preview");
          output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
      }

      document
        .getElementById("profileForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();
          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const phoneNumber = document.getElementById("phoneNumber").value;
          const bio = document.getElementById("bio").value;
          const subjects = document.getElementById("subjects").value;
          const skills = document.getElementById("skills").value;

          const response = await fetch("/api/users/update", {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name,
              email,
              phoneNumber,
              bio,
              subjects,
              skills,
            }),
          });

          if (response.ok) {
            alert("Profile updated successfully!");
          } else {
            alert("Error updating profile.");
          }
        });
    </script>
  </body>
</html>
